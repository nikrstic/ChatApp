<Window x:Class="ChatClient.Views.PrivateChatWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:emoji="clr-namespace:Emoji.Wpf;assembly=Emoji.Wpf"
        Title="{Binding ChatTitle}" Height="500" Width="440"
        WindowStartupLocation="CenterOwner">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

      
        <!-- Poruke aktivnog privatnog chata -->
        <ListBox Grid.Row="0" Grid.Column="1"
                 ItemsSource="{Binding ActiveChat.Messages}"
                 BorderBrush="Gray"
                 BorderThickness="1"
                 Margin="0,0,0,10"
                                />

        <!-- Input + emoji + send -->
        <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal">
            <emoji:TextBox Text="{Binding CurrentMessage, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                           Width="280" FontSize="14" Margin="0,0,10,0"
                           VerticalContentAlignment="Center"
                           Padding="5"/>
            <Button Content="😊"
                    Width="40" Height="40"
                    Command="{Binding EmojiVM.OpenEmojiPanelCommand}"
                    x:Name="EmojiButton"
                    Margin="0,0,10,0"/>
            <Button Content="Send"
                    Width="80" Height="40"
                    Command="{Binding SendCommand}"
                    Background="#007ACC"
                    Foreground="White"
                    FontWeight="Bold"/>
        </StackPanel>

        <!-- Emoji popup -->
        <Popup IsOpen="{Binding EmojiVM.IsEmojiPanelOpen}"
               PlacementTarget="{Binding ElementName=EmojiButton}"
               Placement="Top"
               StaysOpen="False">
            <Border Background="White" BorderBrush="Gray" BorderThickness="1"
                    Padding="5" Width="250" Height="300">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <TreeView ItemsSource="{Binding EmojiVM.EmojiGroups}">
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding Subgroups}">
                                <TextBlock Text="{Binding GroupName}" FontWeight="Bold"/>
                                <HierarchicalDataTemplate.ItemTemplate>
                                    <HierarchicalDataTemplate ItemsSource="{Binding Emojis}">
                                        <TextBlock Text="{Binding SubgroupName}" FontStyle="Italic"/>
                                        <HierarchicalDataTemplate.ItemTemplate>
                                            <DataTemplate>
                                                <Button Content="{Binding}"
                                                    Command="{Binding DataContext.EmojiVM.InsertEmojiCommand,
                                                                      RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}"
                                                    Margin="2"
                                                    FontFamily="Segoe UI Emoji"/>

                                            </DataTemplate>
                                        </HierarchicalDataTemplate.ItemTemplate>
                                    </HierarchicalDataTemplate>
                                </HierarchicalDataTemplate.ItemTemplate>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>
                    </TreeView>
                </ScrollViewer>
            </Border>
        </Popup>
    </Grid>
</Window>
